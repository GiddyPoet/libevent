# 2.5 触发模式


水平触发和边缘触发， 类似于数字电路当中的电位水平， 从低电平到高电平的瞬间触发动作叫边缘触发， 而处于高电平触发动作叫做水平触发。

##2.5.1 水平触发



> 水平触发其实就是和电平变化一样，如果此时一直处以水平状态，则就会触发消息收发，即假如内核在当前监听的套接字有事件,epoll_wait将会再次返回。可以分多次读取。
> 猜测原理：内核会检测状态，再次将套接字放到就绪队列。
> 支持阻塞的套接字和非阻塞的套接字。

![](libevent-2-epoll触发模式01.png)



---

![](libevent-2-epoll触发模式02.png)


---

水平触发的主要特点是，如果用户在监听epoll事件，当内核有事件的时候，会拷贝给用户态事件，但是如果用户只处理了一次，那么剩下没有处理的会在下一次epoll_wait再次返回该事件。

这样如果用户永远不处理这个事件，就导致每次都会有该事件从内核到用户的拷贝，耗费性能，但是水平触发相对安全，最起码事件不会丢掉，除非用户处理完毕。

##2.5.2 边缘触发

> 边沿触发，则是当电平发生变化时才会触发，即当监听的读事件，缓存区从空变为可读，当监听的写事件，缓存区可写的时候发生变化。这种情况会导致数据丢失，因此需要一次性将读取完毕。
> 猜测原理：内核不检测状态，不会再次将套接字放到就绪队列中。
> 只支持非阻塞的套接字，通过触发erron判断是否读取完毕，其实用阻塞的套接字也可以，但是没办法判断当前套接字是否读取完毕，如果没有读取完毕会对后续产生影响。


![](libevent-2-epoll触发模式03.png)



---

![](libevent-2-epoll触发模式04.png)

边缘触发，相对跟水平触发相反，当内核有事件到达， 只会通知用户一次，至于用户处理还是不处理，以后将不会再通知。这样减少了拷贝过程，增加了性能，但是相对来说，如果用户马虎忘记处理，将会产生事件丢的情况。